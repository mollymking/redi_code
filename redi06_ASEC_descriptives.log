--------------------------------------------------------------------------------
      name:  redi06_ASEC_descriptives
       log:  /Users/mollymking/Documents/SocResearch/Dissertation/redi/redi06_AS
> EC_descriptives.log
  log type:  text
 opened on:   9 Sep 2021, 11:01:23

. 
. //      project:        REDI Methods Paper
. 
. //  task:       Descriptive data tables of ORIGINAL continuous ASEC Variables 
> - before conversion to BINCONT
. //  data:       CPS ASEC from IPUMS, available: https://cps.ipums.org/
. 
. //  github:     redi
. //  OSF:                https://osf.io/qmhe8/
. 
. //  author:     Molly King
. 
. display "$S_DATE  $S_TIME"
 9 Sep 2021  11:01:23

. 
. ***--------------------------***
. // # PROGRAM SETUP
. ***--------------------------***
. 
. version 16 // keeps program consistent for future replications

. set linesize 80

. clear all

. set more off

. set seed 1

. 
. local conv_year = 2017 // this is set in redi01_CPI-U-RS.do

. 
. use $deriv/redi05_ASEC_bins-hinc.dta, clear
(Household Income - CPS ASEC data)

. save $deriv/redi06_ASEC_descriptives-hinc.dta, replace
file ~/Documents/SocResearch/Dissertation/data/data_derv/redi06_ASEC_descriptive
> s-hinc.dta saved

.         
. ***--------------------------***
. // INFLATION
. ***--------------------------***                
. 
. merge m:1 year using $deriv/redi01_CPI-U-RS.dta

    Result                           # of obs.
    -----------------------------------------
    not matched                            39
        from master                         0  (_merge==1)
        from using                         39  (_merge==2)

    matched                           139,441  (_merge==3)
    -----------------------------------------

. keep if _merge == 3 // keep only matches - not matched where different years
(39 observations deleted)

. drop _merge

. svyset [iweight=asecwth]

      iweight: asecwth
          VCE: linearized
  Single unit: missing
     Strata 1: <one>
         SU 1: <observations>
        FPC 1: <zero>

. save $deriv/redi06_ASEC_descriptives-hinc.dta, replace
file ~/Documents/SocResearch/Dissertation/data/data_derv/redi06_ASEC_descriptive
> s-hinc.dta saved

. 
. 
. *original income variable, adjusted for inflation
. local inflated_reference_var "asec_hinc_shp_`conv_year'"

. gen asec_hinc_shp_`conv_year' = hhincome / conv_factor

. format asec_hinc_shp_`conv_year' %6.0fc

. label var asec_hinc_shp_`conv_year' "Inflation-adjusted household income (ASEC
> ), from shp categories, `conv_year' dollars"

.                 
.         
. ***--------------------------***                
. // GRAND MEAN 
. ***--------------------------***                
.                 
. capture drop asec_hinc_shp_`conv_year'_mean

. gen asec_hinc_shp_`conv_year'_mean = .
(139,441 missing values generated)

. label var asec_hinc_shp_`conv_year'_mean "household (ASEC) shp grand mean"

. 
. levelsof year, local(years)
2016 2017

. foreach y of local years { // loop through all years
  2. 
.         di in red "Calculate grand mean for hinc shp for year `y'"
  3.         svy: mean asec_hinc_shp_`conv_year' if year == `y' // 
  4.         cap matrix X = r(table) 
  5.                 cap loc mf = X[1,1]
  6.                 di `mf'
  7.         replace asec_hinc_shp_`conv_year'_mean = `mf' if year == `y'
  8. 
. } // end loop through years
Calculate grand mean for hinc shp for year 2016
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       1            Number of obs   =       69,484
Number of PSUs   =  69,484            Population size =  126,067,560
                                      Design df       =       69,483

--------------------------------------------------------------------
                   |             Linearized
                   |       Mean   Std. Err.     [95% Conf. Interval]
-------------------+------------------------------------------------
asec_hinc_shp_2017 |   80822.03   403.8489      80030.49    81613.57
--------------------------------------------------------------------
80822.029
(69,484 real changes made)
Calculate grand mean for hinc shp for year 2017
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =       1            Number of obs   =       69,957
Number of PSUs   =  69,957            Population size =  126,519,332
                                      Design df       =       69,956

--------------------------------------------------------------------
                   |             Linearized
                   |       Mean   Std. Err.     [95% Conf. Interval]
-------------------+------------------------------------------------
asec_hinc_shp_2017 |   82957.25   419.9373      82134.17    83780.33
--------------------------------------------------------------------
82957.25
(69,957 real changes made)

. 
. save $deriv/redi06_ASEC_descriptives-hinc.dta, replace
file ~/Documents/SocResearch/Dissertation/data/data_derv/redi06_ASEC_descriptive
> s-hinc.dta saved

. 
. ***--------------------------***                
. // MEDIAN
. ***--------------------------***
. 
. // Levels of year variable to loop through years
. 
. foreach y of local years { // loop through all years
  2. 
.         di in red "Below is the median hinc for `y':"
  3. 
.         _pctile  asec_hinc_shp_`conv_year' [pweight=asecwth] if year == `y', p
> (50)
  4.         return list
  5. 
. } // end loop through years
Below is the median hinc for 2016:

scalars:
                 r(r1) =  57229.83984375
Below is the median hinc for 2017:

scalars:
                 r(r1) =  58849

. 
. ***--------------------------***                
. // # GINI COEFFICIENT }
. ***--------------------------***
. 
. *use -fastgini- because allows pweights
. *https://www.stata.com/statalist/archive/2008-10/msg01179.html
. *fastgini varname [if] [in] [weight] [, bin(#) jk Level(#) nocheck]
. 
. foreach y of local years { // loop through all years
  2. 
.         use $deriv/redi06_ASEC_descriptives-hinc.dta, clear
  3.         keep if year == `y'
  4.         
.         di in red "Below is the gini hinc for `y':"
  5.         
.         fastgini asec_hinc_shp_`conv_year', nocheck
  6.         local gini  r(gini) 
  7.         di `gini'
  8.         
. } // end loop through years
(Household Income - CPS ASEC data)
(69,957 observations deleted)
Below is the gini hinc for 2016:

Gini coefficient = 0.4775483
.47754829
(Household Income - CPS ASEC data)
(69,484 observations deleted)
Below is the gini hinc for 2017:

Gini coefficient = 0.4807589
.48075887

. 
. ***--------------------------***
. // CLEAN UP
. ***--------------------------***
. 
. log close redi06_ASEC_descriptives
      name:  redi06_ASEC_descriptives
       log:  /Users/mollymking/Documents/SocResearch/Dissertation/redi/redi06_AS
> EC_descriptives.log
  log type:  text
 closed on:   9 Sep 2021, 11:01:26
--------------------------------------------------------------------------------
